
import Test.Tasty
import Test.Tasty.SmallCheck
import Test.Tasty.HUnit
import Test.Tasty.Golden

import Network.TeleHash.Dht
import Network.TeleHash.Types
import Network.TeleHash.Utils

import Data.List
import Data.Ord

main :: IO ()
main = defaultMain $
  testGroup "Tests"
    [ testGroup "(checked by SmallCheck)"
        [ testProperty "sort == sort . reverse" $
            \list -> sort (list :: [Int]) == sort (reverse list)
{-
        , testProperty "Fermat's last theorem" $
            \x y z n -> (n :: Integer) >= 3 ==>
              x^n + y^n /= (z^n :: Integer)
-}
        ]

    , testGroup "Unit tests"
        [ testCase "List comparison (different length)" $
            [1, 2, 3] `compare` [1,2] @?= GT
{-
        , testCase "List comparison (same length)" $
            [1, 2, 3] `compare` [1,2,2] @?= LT
-}
        ]
    , testGroup "DHT"
        [ testCase "Basic hash distance calculation" $
            (distanceTo ourHash (head testHashes)) @?= 241

        , testCase "Basic hash distance calculation is reversible" $
            (distanceTo (head testHashes) ourHash) @?= 241

        , testCase "Hash to bucket 252" $
            (distanceTo bucket252 ourHash) @?= 252
        ]
    ]



-- ---------------------------------------------------------------------

-- The following data set comes from
-- https://github.com/telehash/telehash.org/blob/master/dht.md (2014-5-18)
-- and it's reference to http://pastebin.com/0mBr3D8V

ourHash :: HashName
ourHash = HN "736711cf55ff95fa967aa980855a0ee9f7af47d6287374a8cd65e1a36171ef08"

bucket252 :: HashName
bucket252 = HN "6b4c8662ccc9e7fb46094b64d4edb714e34ab07cde7218c1a3e797abcec60eec"

testHashes :: [HashName]
testHashes =
  [ HN "73654507a9fd1202c6a9381b626d1903a36eafe8a6240bcc726fc668a35d6268"
  , HN "7364913c962d98383b0aa696711ce5be67d7f5cd5e0c022ab08c118b1b25670b"
  , HN "736479bc062e19c429e4a8a147231e0dd5a494eb47beb951d2d83e39709947b2"
  , HN "7364336bef1d492caf5644708b75fa418784790f327d78243fbc5e6f38ecb141"
  , HN "7364fb85d8abd72f3b7d80b579a020093ccfca800cd4e81eff349ee0540b67a7"
  , HN "7362651360238f87de3d943c9ea2749f5e0d4e7ef7afd82f65ffa6480796f0e6"
  , HN "73635c8fed4f1c0b6d762291377259f7ac298a055a3cbaa4e6c475b95910dfbb"
  , HN "7363c73e9274063df9cb20719afcba53862b0136279190314f96f300a42838fd"
  , HN "7363e3c5649ba9c5aab2fe3b295e075c093aabb6cc935d93689e877c6dcb9e67"
  , HN "736e5a202e8e49beeb143dbfb9b8bbf8a8151fb44b834237bf682c445c0e8174"
  , HN "7369568764024760b55e0a67aac8acf8238458e48434f06bf4f5c16611087b76"
  , HN "73686dc238e5244d9be555b1d08b513a7a375b5e7b377c9c442890831cd2eb3c"
  , HN "736fea097330fc8063c7f04d9631e4696d558cfff164317c7b8acaad8a39c1cf"
  , HN "736efb2c9b485557476607e8ffa629427faa4bd84b38338315417046d53af84d"
  , HN "736b6e3a9b653705c6539f06e0d166bd2e2bdb06f7a787ee5853f180f085c069"
  , HN "73689a0a665fe6f2e9d2ddafb1eebf1b7c88a897f7d09a474ef0d3571f812df7"
  , HN "736e942744e4c96f1a23b04ca550346272c0168109af5c61e4555d6f972f5001"
  , HN "736ba0d1d3ce074f89c6e2ae0fede07da26b2aaa6911c8c8e710d21799c99f30"
  , HN "7378d1f5ef5d79e20e7f02401763c585728599a5402cf56639defe5ef667199b"
  , HN "7375453936c015726a0315bca493f54fd08a777d4f70d79459f44e45257d73ae"
  , HN "73765b3b012289b2828f647cf9f3393ee246ae3246966072bd631be004c9fdc1"
  , HN "73767fdfc220e64c084e8ac826e63070832d7e3a9a4a0407d63ffe3613aba22c"
  , HN "7377e8086216c29bfbe1cc63d6227fd9deeec0fddc8fbeee0c4fc5c16b6eb44e"
  , HN "7379b27cf68f082346b20af1b4578489b3b808cb173036c3b72de1dfe7475130"
  , HN "7372d39f7d1aaca4c9018df3e30aafa6a4ab1db1ef8fb3b34f7633a683adf9de"
  , HN "73722b55cf3d9d76cb20623695eb63a4de20196e170575b41bce263f17fbe456"
  , HN "737036c5b9888df9446bf930c55c7ca0909c5db99026be43f9068665b9ebe583"
  , HN "73536fba1cf1e85b9343f04bc497bb1d1574768cfdeb79070f7d8ae3a4eb5ddd"
  , HN "73424586316330ac01845a3ea05ea3f92eee51a50fe1b214326b9999c3931af1"
  , HN "73402ceca0d363423cd082a45c70ba17a466d73b5010ab950b658d71d3363b81"
  , HN "73586269b7253ced6015562e3248c733e5361a027038f0c870e0f7f08f1c1c14"
  , HN "7348e436f94567faabe64139d29fede4ae16b2cdf885cda81884ee4b680ae7e3"
  , HN "7345c3a00d9459c3590258d8c43ff9cb7ba9cba79ddae99769aac40eb044ccb2"
  , HN "734810b4384e84ec1b8ca7056586b0218a43137f7a68152e268133a0d46320f2"
  , HN "735dbaf3c17bf6bb4c0e3ce9d091648eaf20f806c1fd952b127cb55d16ea55bc"
  , HN "734352be1cedbafd7156b3cd5b016c7620c7ef91fbd03d175ea456b56cebd774"
  , HN "731c9a75a888542ea45afeea167cee4ed728384137e8f14decef5803b563e977"
  , HN "730d4cca10a46730bdb687f2b0fd0612f398309d535b830970c7ec2bb4685c50"
  , HN "73312141cff2848ffd8873cc1f380b3c2a1b889c3ac2f9024e1167100dde32d1"
  , HN "73363ebd6a39e1e8ead812812ef66e882691383f93002d37fe417dcc621c0ee4"
  , HN "733a57a74b857fa81106187da2f2eecc5f642eb6ccfed106980d83453f9b8765"
  , HN "732891c68d4fc9da16f08c899f9c2533367f022ee9a1571a17be55044b624723"
  , HN "7312f85760cdfb32fce79d42b81a179977786a84c70ec7d1ee4d521072706ef7"
  , HN "732c1118ba85942e8f991495bef2ec37de0061bc4b8ca790c780ca7ad8235715"
  , HN "7339bb22d2360d012ecc204011a000ea02bbd3a31053fb5baae584efdfc66879"
  , HN "73f42dd92d65a9e771d6ac560dc4ad3592e8c5a66982e320bac76c0d49533f0d"
  , HN "73f0975879d16cb54d82a0f6c3ce1c8612540c5972d4ed5e2f653b5969935ea9"
  , HN "73c054f89f1490c665e59ef1e10d33fbf5fbd83a63c62acced972d8e40c6707b"
  , HN "739dbfb18493a3f0cc6461782580caab2e16a0c567fc301b7234135e5abe9b8d"
  , HN "73b28eb2bba3b03f15603531b8946610bc74c89107a6e2e9e7a2f9fdf2b3ac68"
  , HN "7394669b238015cf273ee8ab41df912bdafda6c202895a752de3f398596b35d9"
  , HN "73d75e381485cbd77add07cb0a4f9208ae54c1cb61b4c9572fb72a88678e00ea"
  , HN "73b30d7fe494d62f43a6d07fc2fc7224c50e134bf782608fe609435ce015330f"
  , HN "73a52253ea3b3b6fe43dff0b15cbb7bb411750ffb4bd060b31721dc1dae069ee"
  , HN "721dba28fd17603cf2745462d741cdf4b3435671904cd9b02329cb52b134f60c"
  , HN "72bec480fc8ee3fc3c9e5e995315f28e449ef3b30e2902ec9808bf0b273a2e66"
  , HN "7207c9da925852fc3994b8519b4135c978050b2aebba1e4b8abfb1946a11eddc"
  , HN "72dd66086cd0c5a91014752f739b233f512b3e288546eaca3decd7b4e9365ee1"
  , HN "72d803501d1bb95a7fde93a89789917e9b79a3c17f8c864dbc1cf927c13c1d79"
  , HN "729fa0615b219394adda7024c921567498620118944c1f3618d9069e064826fa"
  , HN "7292fcb82c126dba2e1384d921edf0ea2926bed399272ac786a4bf27c1be1b6e"
  , HN "7213b1006706b5062aada0658fd5f46a5e06c145762bc31b2a23c450a883d0a1"
  , HN "7238f859cd9bd75b79f6f211a30d238e9bb136b7cb55085bf4c556c37fefd532"
  , HN "71d64b6a2d7377fc3ab13010d62cd5e59171473348174cf9f629fc0c40756a4d"
  , HN "705231101e0d59a90f7a716c44982edab63c74341d8672e4ae7fecba73459790"
  , HN "709c7834d14b52391875ecbee212976c7fe8fa67cc85fe52d645d2889435ea7e"
  , HN "71a58649946a35ada19c39c8334caa001329a409036ab659d93ce308b01dd1ab"
  , HN "70679c3a89a65785ccec34bf8cbde19cc0c3474642550ff35f76920a95ebef86"
  , HN "7134008e1e7ff24f0b6599bd80debd111d2f842a1fa989a90cc002035afab282"
  , HN "715e825e6bb5963ff077667661c2e28a9719974bd0ab13bac7ef790c612df222"
  , HN "70a6f8fe7a5f7818770d91f3ceee37f57b8b11ca7f84c3d7023f02d02c3fe918"
  , HN "71d4ff185299c1537eeb5668eb8a1c429b48e763a8e7c137023be51acccc353d"
  , HN "755970f1c13cc6a6dc1f2cbf880563ceaaf62dc4b2a4043abd5d37f1308bd5d6"
  , HN "76a302ff56b9a96a17f5d62ada2fe6b4f26991ec3680948440690d92a0f61cf0"
  , HN "76c473f4aafdee62ce6733b62c2c6da188854bb6c5c429e8c7e9d2e19893f745"
  , HN "76b94d57da3e0ff305f828726fc3338849dc08d7b3a8eca21c4def95e401ec1c"
  , HN "74ca2409715c0a8b1b242cccb23501c84db64e675a96a659a85df6539c873087"
  , HN "748bbc494827eac076c5a194230be4fd5dd13c973acfd35b381c7eaa58c62f50"
  , HN "7595c3a83db236221fd772223693034282d7972468d65c0ef47f2cce0e1e6fea"
  , HN "74f01df4803da4bb437437dbf56a7ea06b4e14d5ab9b92e5a287fbf66986cc90"
  , HN "7521713db63e064d39a82a03883c83577bf98fdb26fde7a31525a5dfc54f4766"
  , HN "7d906fbc8d5bead0d62ed50b8ec988eae541afb5d2d6bd7bd3d0c8c0e250185e"
  , HN "7e602c53a42be331f7b3b800b80cdeabe84dc61195009d05805b87b97e4057f8"
  , HN "7bb5f5a8c368dd168534a3ee7f22a1e83e136e7b452fdb208dea26b5c47700fd"
  , HN "7ed8f998435274c898ac4da9d2b726c753b0e817bc9706a87b3c48d0e4f8e606"
  , HN "7e2b134fdbbd6f5919fe618a256d5da5b550c9b76b125fc454534220b9664731"
  , HN "7bc80326a0d796361baf9d9bd9fa2f57cdcc50a1b751038696178d6fbcef18a7"
  , HN "7e39275b911144cd4348d7bc9e70147378f0470432adfff05b1e7d18e28831fc"
  , HN "7a3079bd01c3f881a7b3f3ba79c39917425330a5a785294541e8cae773826ebe"
  , HN "7bf04f76938b7ee2d3592d78a756a92d96347dcf1050d399c931cef7e4226429"
  , HN "6b4c8662ccc9e7fb46094b64d4edb714e34ab07cde7218c1a3e797abcec60eec"
  , HN "650a7c410019e8e566055f17ca2abcbbf90107a3fb7232beaab201d5d4ba764f"
  , HN "6296912a23386acfe7dc32a43a6799a0ae86c4231442378e663060b1de12ff4d"
  , HN "62c56cedf5960772f67864a828dd5211e875e1970a2fdc2ac905cbf293cc21d3"
  , HN "6867855d2df10ee66c4a7e7193347e5aa1e2fc9039fe41b640b7d5b0c6ac772b"
  , HN "61ad02c966e46f4217733cca182b18fdb9ac09f8bc0affe7ac32d35086653926"
  , HN "6a0c63500018384254d9c912eb7e80653f05c82410c9ec5403d79b3356fc633d"
  , HN "6f51b62d728d6790c27af039a1cc8c97d298afb33faf4fe1ee47d4b76041dec2"
  , HN "69d95e87eee5efec12eded62902e92b759f88ebc75028b39088b7fed1a8668cb"
  , HN "47b5281f22910f660c01fc518c60ed8755499b47725738de1be14a948b09b139"
  , HN "4cc712ad4c06796cc11958b3cc06cde525584b0b596cb7bcaf1d7d2a7b933459"
  , HN "532ec0ecf47050fe4ae8eb2d848efe767cfe9c1ffc7ddc0381d1277681f2e56d"
  , HN "5210734ebb93d99c12f1c43c796734747daebd25ca0733ae35e94a8d9bcfcfad"
  , HN "43bdea74753899bdf4e97687bb0d686e7db9bb70ec56e9e5aacd69eb7f2e5753"
  , HN "5a151a115bcd8af0f4d618c53644f486415997ced7578b50e912b479616fa33b"
  , HN "4bdb799845eb72b5eb47bd34b0bcb2c2b67681c10b395ca9c65edc34d27f1178"
  , HN "477f1b83983d05dc122dfb739fcd547d29fb4e51a1a1f364e54f8b99daf9976f"
  , HN "45c83c2143a02c695daaa459b9bcf98660979ac8e29db6e87072bf0ddb9ba763"
  , HN "1fc84a5a1c35aac15d4014cceb77e6630dda153723b33c7805092f198277e99e"
  , HN "344c8b1a803fa3ab9bc2539c6da6c15ffb9e1082d8271ac6abde05795b8c8446"
  , HN "29015d27c4f6e1360b64afdb29c7c14bd81b70ea42d708e6bb70d57227059725"
  , HN "06a4423da6111820fdc762114e669c680721d75c464ca3c1d16986a0f695f1e5"
  , HN "2e1d28a701d3b630ef282a6d04924c256131dad3f86b4b44510c8218f3a2fc69"
  , HN "153c82fb9267ea071f41914cad2a8e8441be17ba17bdc2d2c3374001a533eb78"
  , HN "1da6bfffd022615dbaeed5ed2c1444e0e50290fda9232572a9933a62dd39dda9"
  , HN "1a9ad44cd94f6bcd89b841233230f60a83ae3ac0d16fffc1cd9153ab77794bcd"
  , HN "1ce7f80592954c4c9abd8a77ab9a3222166da12fb2a6efe39b2e5dcee1111ef6"
  , HN "f7689fe81620568fc72030e7946a8ad86b4a700a190760b6bec6074a9661284d"
  , HN "cdb80b529e7ba4c058e58baf14ba1291056045e8759d71d171679431f66827e4"
  , HN "c81b5016476e71b57d896114da47e0224e4d34a9cb82ec6af7ff010c5963e9ec"
  , HN "9943b8304c315d3020ccbd8ef6108538a610ff709da913728bdae4847c1fff9e"
  , HN "c943673ed22bb96bafdf4806890d016f97c09c7cf2bc1b1692e4aaaaf8953a85"
  , HN "f3277426e17299a3a84858d29a0db02a6275400f02bd2c26a7cff504e7f4d7b6"
  , HN "aad3515c8dcf0303a3601292f066c1978e279dd5926760736f67ef2b01760a49"
  , HN "c9612ee9143e473968a60cd696e56fa4cc187b7b6619404e60bee8aa2f66fa0c"
  , HN "8857604e4528046029f06894ecb0b6aff6b045086db70aa47b15b092149a5d04"
  ]
